<!DOCTYPE html>
<Title>2008 Visualization</Title> 
<header>
    <div id="header">
  <h1>2008 Chart</h1>
    </div>
    
    
    <div id="section">
        <a href="index.html">Return to Homepage</a></p>
        <a href="Chart2.html">Go to the next year</a></p>
<head>
  <meta charset='utf-8'>
  <script src='https://d3js.org/d3.v4.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js'></script>
  <style>
    .axis-bottom .domain {
      display: none;
    }
    
    .n {
      opacity: .8;
      font-size: 10px;
      margin-left: 4px;
      font-family: Helvetica;
      color: white;
      padding: 6px;
      background-color: #3C3176;
    }
 
  </style>
</head>

<body>
  <script>
        
const data = [
  {
    'City': 'Beijing',
    'Under 5 Years': 0.3853,
    '5 to 13 Years': 0.4499,
    '14 to 17 Years': 0.2709,
    '18 to 24 Years': 0.3491,
    '25 to 44 Years': 0.0604,
    '45 to 64 Years': 0.8819
  },
  {
    'City': 'Shanghai',
    'Under 5 Years': 0.2027,
    '5 to 13 Years': 0.4300,
    '14 to 17 Years': 0.1420,
    '18 to 24 Years': 0.2454,
    '25 to 44 Years': 0.7017,
    '45 to 64 Years': 0.5656
  },
  {
    'City': 'Guangzhou',
    'Under 5 Years': 0.4208,
    '5 to 13 Years': 0.2141,
    '14 to 17 Years': 0.5078,
    '18 to 24 Years': 0.9120,
    '25 to 44 Years': 0.5235,
    '45 to 64 Years': 0.2054
  },
  {
    'City': 'Chongqing',
    'Under 5 Years': 0.8528,
    '5 to 13 Years': 0.9439,
    '14 to 17 Years': 0.3738,
    '18 to 24 Years': 0.1607,
    '25 to 44 Years': 0.4782,
    '45 to 64 Years': 0.4746
  },
  {
    'City': 'Shenzhen',
    'Under 5 Years': 0.8943,
    '5 to 13 Years': 0.1558,
    '14 to 17 Years': 0.7258,
    '18 to 24 Years': 0.1479,
    '25 to 44 Years': 0.3593,
    '45 to 64 Years': 0.9173
  },
  {
    'City': 'Hangzhou',
    'Under 5 Years': 0.737462,
    '5 to 13 Years': 0.1345341,
    '14 to 17 Years': 0.679201,
    '18 to 24 Years': 0.1203944,
    '25 to 44 Years': 0.3157759,
    '45 to 64 Years': 0.3414001
  }
];

const keys = Object.keys(data[0]).slice(1);
    
const tip = d3.tip().html(d=> d.value);

const margin = {
    top: 40,
    right: 80,
    bottom: 20,
    left: 240
  },
  width = 800,
  height = 480,
  innerWidth = width - margin.left - margin.right,
  innerHeight = height - margin.top - margin.bottom,
  svg = d3.select('body').append('svg').attr('width', width).attr('height', height)
  g = svg.append('g').attr('transform', `translate(${margin.left}, ${margin.top})`);
    
svg.call(tip)

const x0 = d3.scaleBand()
  .rangeRound([0, innerWidth])
  .paddingInner(.1);

const x1 = d3.scaleBand()
  .padding(.05);

const y = d3.scaleLinear()
  .rangeRound([innerHeight, 0]);

const z = d3.scaleOrdinal()
  .range(['#AA9439', '#3C3176', '#2C4770', '#96A537', '#68266F', '#492E74']);
    
  x0.domain(data.map(d => d.City));
  x1.domain(keys).rangeRound([0, x0.bandwidth()]);
  y.domain([0, d3.max(data, d => d3.max(keys, key=> d[key]))]).nice();

g.append('g')
  .selectAll('g')
  .data(data)
  .enter()
  .append('g')
  .attr('transform', d => 'translate(' + x0(d.City) + ',0)')
  .selectAll('rect')
  .data(d => keys.map(key => {return {key: key, value: d[key]}}))
  .enter().append('rect')
  .attr('x', d => x1(d.key))
  .attr('y', d => y(d.value))
  .attr('width', x1.bandwidth())
  .attr('height', d => innerHeight - y(d.value))
  .attr('fill', d =>  z(d.key))
  .on('mouseover', tip.show)
  .on('mouseout', tip.hide)

g.append('g')
  .attr('class', 'axis-bottom')
  .attr('transform', 'translate(0,' + innerHeight + ')')
  .call(d3.axisBottom(x0));

g.append('g')
  .attr('class', 'axis-left')
  .call(d3.axisLeft(y).ticks(null, 's'))
  .append('text')
  .attr('x', 10)
  .attr('y', y(y.ticks().pop()) + 10)
  .attr('dy', '0.32em')
  .attr('fill', '#000')
  .style('transform', 'rotate(-90deg)')
  .attr('font-weight', 'bold')
  .attr('text-anchor', 'end')
  .text('Population');

const legend = g.append('g')
   .attr('font-family', 'sans-serif')
   .attr('font-size', 10)
   .attr('text-anchor', 'end')
   .selectAll('g')
   .data(keys.slice().reverse())
   .enter().append('g')
   .attr('transform', (d, i) => 'translate(0,' + i * 20 + ')');

legend.append('rect')
  .attr('x', innerWidth - 19)
  .attr('width', 10)
  .attr('height', 10)
  .attr('fill', z);

legend.append('text')
  .attr('x', innerWidth - 32)
  .attr('y', 6)
  .attr('dy', '0.32em')
  .text(d => d);

  </script>
  <style>
#header {
    background-color:blue;
    color:white;
    padding:7px;
}
    body {
  font: 15px Helvetica;
}
</body>